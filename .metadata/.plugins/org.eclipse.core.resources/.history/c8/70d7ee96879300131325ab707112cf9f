

import jAudioFeatureExtractor.ACE.DataTypes.FeatureDefinition;
import jAudioFeatureExtractor.AudioFeatures.MagnitudeSpectrum;
import jAudioFeatureExtractor.AudioFeatures.PeakFinder;

import java.io.File;
import java.io.FileNotFoundException;

import javax.sound.sampled.AudioInputStream;
import javax.sound.sampled.AudioSystem;

import java.io.File;
import java.io.FileNotFoundException;

import javax.swing.*;
import javax.swing.filechooser.*;


public class LoadSpeechWaveform{
	static FileNameExtensionFilter filter = new FileNameExtensionFilter("Speech waveform files, (.wav)", "wav");
	static JFileChooser fileChooser = new JFileChooser();
	static File inFile;
	private static final double MAX_16_BIT = Short.MAX_VALUE;     // 32,767

	
	public static double[] fileReader() throws FileNotFoundException{
		fileChooser.setFileFilter(filter);
		if (fileChooser.showOpenDialog(null) != JFileChooser.APPROVE_OPTION)
			throw new Error("Input file not selected");
		inFile = fileChooser.getSelectedFile();
		double[] audioData = read(inFile);
		System.out.println("Opened:" + inFile.getName());
		
		return audioData;
	} 
	 
	 /**
     * Read audio samples from a file (in .wav or .au format) and return them as a double array
     * with values between -1.0 and +1.0.
     */
    public static double[] read(File file) {
        byte[] data = readByte(file);
        int N = data.length;
        double[] d = new double[N/2];
        for (int i = 0; i < N/2; i++) {
            d[i] = ((short) (((data[2*i+1] & 0xFF) << 8) + (data[2*i] & 0xFF))) / ((double) MAX_16_BIT);
        }
        return d;
    }
    
	// return data as a byte array
    private static byte[] readByte(File file) {
        byte[] data = null;
        AudioInputStream ais = null;
        try {

            // try to read from file
            if (file.exists()) {
                ais = AudioSystem.getAudioInputStream(file);
                data = new byte[ais.available()];
                ais.read(data);
            }

        }
        catch (Exception e) {
            System.out.println(e.getMessage());
            throw new RuntimeException("Could not read " + file.getName());
        }

        return data;
    }

	
	public static void main(String[] args) throws FileNotFoundException{
		double[] audioData = fileReader();
		System.out.println(audioData.length);
		
		//Find the peaks in our .wav file
		ComputePeakFinder cpf = new ComputePeakFinder(audioData);
		double[] audioPeaks = cpf.compute();
		
		//Now send the audioData and the peakData to our class that will split up the audio
		//and then send back a bunch of new .wav files that we will individually scan for
		//MFCC's
		
		//Find the mfcc in our .wav file.
		ComputeMFCC mfcc = new ComputeMFCC(audioData); //Create a new instance of ComputeMFCC and pass it our double array.
		double[][] featureValues = mfcc.run();
		
	}
}
